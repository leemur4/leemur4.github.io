<!DOCTYPE html>
<!-- saved from url=(0099)https://dl.dropboxusercontent.com/u/48039300/routeplanner/clients/wimm-bill-dann/wbd-nn-filter.html -->
<html xmlns="http://www.w3.org/1999/html"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>WBD-NN Filter</title>
    <style type="text/css">
        body {
            font: 16px sans-serif;
            margin: 0;
        }

        textarea, input, select {
            font: 14px sans-serif;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin: 0;
            padding: 4px 5px;
        }

        textarea:focus, input:focus, select:focus {
            border-color: #5ab;
            box-shadow: 0 0 15px rgba(50, 200, 255, 0.5);
        }

        .btn {
            background: #d7ebf9;
            border: 1px solid #aed0ea;
            border-radius: 6px;
            color: #2779aa;
            font-size: 2em;
            cursor: pointer;
            display: inline-block;
            text-decoration: none;
            margin: 2px 0;
            padding: 12px 30px 14px;
        }

        .btn-sm {
            background: #d7ebf9;
            border: 1px solid #aed0ea;
            border-radius: 6px;
            color: #2779aa;
            font-size: 1em;
            cursor: pointer;
            display: inline-block;
            text-decoration: none;
            margin: 2px 0;
            padding: 5px 20px;
        }

        .btn:hover, .btn-sm:hover {
            background: #e4f1fb;
            border-color: #74b2e2;
        }

        .btn:active, .btn:focus, .btn-sm:active, .btn-sm:focus {
            background: #3baae3;
            border-color: #2694e8;
        }

        .container {
            padding: 15px 10px;
        }

        label {
            display: block;
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-size: 9pt;
        }

        label:first-child {
            margin-top: 0;
        }

        input[type="button"] {
            display: block;
        }
    </style>
    <meta charset="UTF-8">
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var inputXml = document.getElementById('inputXml');
            var zoneContainsEl = document.getElementById('zoneContains');
            var outputXml = document.getElementById('outputXml');
            var logger = document.getElementById('logger');

            inputXml.focus();

            var filterButton = document.getElementById('filterButton');
            filterButton.onclick = function () {
                outputXml.value = '';
                var outputLines = [];
                logger.value = '';

                var domParser = new DOMParser();
                var xmlDocument = domParser.parseFromString(inputXml.value, "text/xml");
                var xmlSerializer = new XMLSerializer();

                var zoneContains = zoneContainsEl.value;
                var removed = 0;

                var nodes = xmlDocument.documentElement.getElementsByTagName("Row");
                var nodesCount = nodes.length - 1;
                for (var i = 0; i < nodes.length; i++) {
                    if (nodes[i].childNodes.length > 0) {
                        var node = nodes[i].childNodes[7].childNodes[0];
                        if (node.textContent.toLowerCase().indexOf(zoneContains.toLowerCase()) !== -1) {
                            logger.value += 'removed ' + node.textContent + '\n';
                            ++removed;
                            nodes[i].parentNode.removeChild(nodes[i]);
                            --i;
                        }
                    }
                }

                var s = xmlSerializer.serializeToString(xmlDocument);
                var p = s.indexOf("?>");
                if (p === -1)  p = -2;
                s = '<?xml version="1.0" encoding="WINDOWS-1251"?>' + s.substring(p + 2);
                outputXml.value = s;

                logger.value += 'number of elements before: ' + nodesCount + '\n';
                logger.value += 'number of elements after: ' + (nodesCount - removed) + '\n';
                logger.value += 'removed ' + removed + ' elements' + '\n';

                logger.focus();
                outputXml.focus();
                outputXml.select();
                document.execCommand('copy');
            };
        })
    </script>
</head>

<body>
<div class="container">
    <div class="container" style="float:left;">
        <label for="inputXml">Xml-файл с заявками</label>
        <textarea id="inputXml" cols="70" rows="8" spellcheck="false" onpaste="this.value=event.clipboardData.getData(&#39;text/plain&#39;);return false;"></textarea>
    </div>
    <div class="container" style="float:left;">
        <label for="zoneContains">Зона отгрузки <strong>не</strong> должна содержать подстроку</label>
        <input id="zoneContains" type="text" value="MG_1">
    </div>
</div>
<div class="container" style="clear:left;">
    <input id="filterButton" type="button" class="btn" value="Фильтровать">
</div>
<div class="container" style="float:left;">
    <label for="outputXml">Выходной xml-файл</label><textarea id="outputXml" cols="70" rows="20" readonly="" spellcheck="false"></textarea>
</div>
<div class="container" style="float:left;">
    <label for="logger">Логи</label><textarea id="logger" cols="70" rows="20" readonly=""></textarea>
</div>


</body></html>
